<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.3.4 (460191)"/><meta name="author" content="Jade Pam"/><meta name="created" content="2020-07-31 06:33:42 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2020-09-04 08:35:53 +0000"/><title>http</title></head><body><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-weight: bold; line-height: 1.75;">一、HTTP协议基础及发展历史</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">1、http概念</span></div><div style="text-align: left; float: none;"><img src="http.resources/27DFD051-2298-4B18-A244-3042960F4B9F.jpg" height="506" width="1368"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">2、5层网络模型介绍</span></div><div style="text-align: left; float: none;"><img src="http.resources/BC567D70-2FF7-4D75-90E3-7084BBF78F78.jpg" height="450" width="644"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">物理层：定义物理设备如何传输数据</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">数据链路层：在通信的实体间建立数据链路链接</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">网络层：为数据在节点之间传输创建逻辑链路</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">传输层：向用户提供可靠的端到端服务，向高层屏蔽了下层数据通信的细节（三次握手/4次挥手）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">应用层：为应用软件提供了很多服务，构建于TCP协议之上，屏蔽网络传输相关细节</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">TCP协议模型详解</span></div><div style="text-align: left; float: none;"><img src="http.resources/E4B5A949-5E86-4999-B7FF-A25151BEC8D1.jpg" height="594" width="1191"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(250, 226, 32); color: rgb(51, 51, 51); font-family: Arial; font-weight: bold; line-height: 1.75;">http 协议和 tcp/ip 协议的关系</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(238, 236, 224); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.75;">HTTP的长连接和短连接本质上是TCP长连接和短连接</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.75;">。但是意图不一样</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; line-height: 1.75;">http keep-alive是为了让tcp活得更久一点，以便在同一个连接上传送多个http，提高socket的效率。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; line-height: 1.75;">tcp keep-alive是TCP的一种检测TCP连接状况的保鲜机制</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.75;">HTTP属于应用层协议，在传输层使用TCP协议，在网络层使用IP协议。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.75;">IP协议主要解决网络路由和寻址问题，TCP协议主要解决如何在IP层之上可靠地传递数据包，使得网络上接收端收到发送端所发出的所有包，并且顺序与发送顺序一致。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.75;">TCP协议是可靠的、面向有连接：</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">发送之前必须建立连接，3次握手，4次挥手（双全工通信）
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(250, 226, 32); color: rgb(51, 51, 51); font-family: Arial; font-weight: bold; line-height: 1.75;">HTTP协议是无状态的</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.75;">HTTP协议是无状态的，指的是</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.75;">协议对于事务处理没有记忆能力</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.75;">，服务器不知道客户端是什么状态。也就是说，打开一个服务器上的网页和上一次打开这个服务器上的网页之间没有任何联系。HTTP是一个无状态的面向连接的协议，无状态不代表HTTP不能保持TCP连接，更不能代表HTTP使用的是UDP协议（无连接）。</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">UDP面向无连接协议：只传负责传；多播，实时的视频和音频传输
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(250, 226, 32); color: rgb(51, 51, 51); font-family: Arial; line-height: 1.75;">RPC 比 http 请求快的原因</span><span style="white-space: pre-wrap; font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; line-height: 1.75;">：http 使用 http 协议，rpc 使用 tcp 协议，比 http 少了应用层、表示层，会话层，这3层，rpc使用长连接，而长连接比短连接更节省资源，效率更高（每个连接的建立和释放都是需要资源和时间的）。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; font-weight: bold; line-height: 1.625;">RPC:</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;" /><span style="white-space: pre-wrap; font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; line-height: 1.625;">网络传输TCP 协议、UDP、HTTP2</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;"
/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; line-height: 1.75;">RPC是指远程调用，两服务器A、B，A要调用B上的一个方法，由于不在一个内存空间，不能直接调用，需要通过网络来表达调用的语义和传达调用的数据</span></div><ol><li style="text-align: left; font-size: 16px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="font-size: 16px; background-color: rgb(250, 226, 32); color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">通讯问题</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">：在客户端和服务端建立TCP连接，远程调用的所有交换数据都在这个连接里传输。</span></div></li><li style="text-align: left; font-size: 16px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="font-size: 16px; background-color: rgb(250, 226, 32); color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">解决寻址</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">问题：IP及端口寻址，方法名</span></div></li><li style="text-align: left; font-size: 16px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="font-size: 16px; background-color: rgb(250, 226, 32); color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">序列化</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">（Serialize）：发生远程调用时，方法的参数需要通过底层的网络协议如TCP传送到服务器，由于网络协议是基于二进制的，内存中的参数值需要序列化成二进制的形式，通过寻址和传输序列化的二进制发送给服务器。</span></div></li><li style="text-align: left; font-size: 16px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">服务器</span><span style="font-size: 16px; background-color: rgb(250, 226, 32); color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">反序列化</span><span style="font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">：服务器收到请求后需要反序列化，恢复内存中的表达方式，然后找到对应的方法（寻址的一部分），进行本地调用。返回值发送给客户端，这个部分也需要序列化和反序列化。</span></div></li></ol><div style="text-align: left; float: none;"><img src="http.resources/05C949CC-8F1E-4C82-A023-FA5F5D05792A.jpg" height="434" width="651"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); font-weight: bold; line-height: 1.75;">Socket是什么</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); line-height: 1.75;">Socket 是传输控制层协议，WebSocket 是应用层协议</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">Socket是应用层与TCP/IP协议族通信的中间软件抽象层，它是一组接口。在设计模式中，Socket其实就是一个门面模式，它把复杂的TCP/IP协议族隐藏在Socket接口后面，对用户来说，一组简单的接口就是全部，让Socket去组织数据，以符合指定的协议。
</span></div><div style="text-align: left; float: none;"><img src="http.resources/1B7A7FBB-35A5-4AE5-868E-8C1716E588C6.jpg" height="478" width="545"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); font-weight: bold; line-height: 1.75;">通信过程：</span></div><div style="text-align: left; float: none;"><img src="http.resources/B7B6D07B-D9E1-493E-ACA3-C1326787DC1B.jpg" height="228" width="552"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); font-weight: bold; line-height: 1.75;">TCP三次握手/4次挥手：</span></div><div style="text-align: left; float: none;"><img src="http.resources/37E57FC7-D822-48F4-9CE7-BADB08C85160.jpg" height="689" width="614"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; color: rgb(51, 51, 51); font-family: Arial; font-weight: bold; line-height: 1.625;">为什么连接的时候是三次握手，关闭的时候却是四次握手？</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，"你发的FIN报文我收到了"。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步握手。
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">需要三次握手才能确认双方的接收与发送能力是否正常
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); line-height: 1.75;">全连接队列</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">：已经完成三次握手，队列满了就有可能会出现丢包现象
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); line-height: 1.75;">半连接队列</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">：服务器第一次收到客户端的 SYN 之后，就会处于 SYN_RCVD 状态
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); line-height: 1.75;">三次握手携带数据</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">：第一次、第二次握手不可以携带数据；避免服务器更加容易受到攻击。而对于第三次的话，此时客户端已经处于 ESTABLISHED 状态。对于客户端来说，他已经建立起连接了，并且也已经知道服务器的接收、发送能力是正常的了，所以能携带数据也没啥毛病。
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); line-height: 1.75;">SYN攻击</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">：服务器端的资源分配是在二次握手时分配的，而客户端的资源是在完成三次握手时分配的，所以服务器容易受到SYN洪泛攻击。
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">四次挥手：这由TCP的半关闭（half-close）造成的。所谓的半关闭，其实就是TCP提供了连接的一端在结束它的发送后还能接收来自另一端数据的能力
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); font-weight: bold; line-height: 1.75;">HTTP长连接与短连接、长轮询与短轮询及长轮询</span></div><div style="text-align: left; float: none;"><img src="http.resources/2409F26A-B3A8-45AF-87A2-F8F4E9238924.jpg" height="424" width="1449"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="text-align: left; float: none;"><img src="http.resources/99621B0B-F1E1-494F-952D-DC161AB04C23.jpg" height="642" width="1425"/><br/></div><div style="text-align: left; float: none;"><img src="http.resources/32AA892F-FD76-4359-9EA6-419D93462AED.jpg" height="444" width="899"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">3、http的发展历史</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">http/0.9：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">只有get，没有header等描述数据的信息，服务器发生完毕，就关闭TCP连接</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">http/1.0：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">增加了很多命令，增加status code和header，多字符集支持、多部分发送、权限、缓存等。服务端响应后即结束，tcp链接三次握手。</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(238, 238, 238); font-family: Verdana; font-weight: bold; line-height: 1.625;">Expires策略</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.625;">在HTTP/1.0中</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(238, 236, 224); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.625;">默认使用短连接</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">http/1.1：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">持久连接（解决三次握手开销），pipeline（通过连接里面发送多个请求，串行），增加host和其他一些命令（物理服务部署），客户端主动请求，服务端被动接受，并行。</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-weight: bold; line-height: 1.625;">Cache-Control策略</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.625;">从HTTP/1.1起，</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(238, 236, 224); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.625;">默认使用长连接</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-family: Tahoma; line-height: 1.625;">，用以保持连接特性。使用长连接的HTTP协议，会在响应头加入这行代码：</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(163, 21, 21); font-family: &quot;Courier New&quot;; line-height: 1.625;">connection</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(43, 145, 175); font-family: &quot;Courier New&quot;; line-height: 1.625;">:keep-alive</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">http/2.0：默认加密</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-weight: bold; line-height: 1.625;">二进制传输：</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.625;">帧是数据传输的最小单位，以二进制传输代替原本的明文传输，原本的报文消息被划分为更小的数据帧，二进制协议解析起来更高效、“线上”更紧凑，更重要的是错误更少</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; font-weight: bold; line-height: 1.625;">多路复用：</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">同一个连接里面发送多个请求不再需要按照顺序来（并行，同一个用户，对同一个服务发起网页请求的时候，只需要发起一个tcp连接）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-weight: bold; line-height: 1.625;">头信息压缩</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">以及推送等提高 效率的功能。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; font-weight: bold; line-height: 1.625;">服务端推送Server-Push</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.625;">：连接建立后，</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">服务端可主动，请求html同时，</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-weight: bold; line-height: 1.625;">服务端</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">把资源</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-weight: bold; line-height: 1.625;">推送</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">到客户端，串行。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; font-weight: bold; line-height: 1.625;">流量控制</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.625;">：每个 http2 流都拥有自己的公示的流量窗口，它可以限制另一端发送数据。对于每个流来说，两端都必须告诉对方自己还有足够的空间来处理新的数据，而在该窗口被扩大前，另一端只被允许发送这么多数据</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">http/3.0：全新协议，底层协议基于UDP，</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">HTTP 应用程序到 QUIC 传输层的映射，解决了传输层队头阻塞问题，QUIC+TLS 1.3
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">UDP 连通性问题、QUIC 不支持明文传输、UDP 消耗资源多
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 15px; background-color: rgb(255, 255, 255); color: rgb(55, 55, 55); font-family: &quot;Courier New&quot;; line-height: 1.5;">QUIC 定位为一个通用安全传输层协议：</span></div><div style="text-align: left; float: none;"><img src="http.resources/06CEC5AD-EFFE-431E-9530-2DD1D88CBD21.jpg" height="1326" width="1492"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); line-height: 1.75;">HTTPS：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.625;">是以安全为目标的 HTTP 通道，简单讲是 HTTP 的安全版，即 HTTP 下加入 SSL 层，HTTPS 的安全基础是 SSL，因此加密的详细内容就需要 SSL</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.625;">当前TLS协议1.2版本包含四个核心协议：握手协议、密钥配置切换协议、应用数据协议及报警协议</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.625;">https = 数据加密（对称和非对称） + 网站认证 + 完整性验证 + HTTP</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">数字证书：CA签发
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">握手协议
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 226, 32); line-height: 1.75;">HTTP 和 TLS 在协议层的位置以及 TLS 协议的组成如下图：</span></div><div style="text-align: left; float: none;"><img src="http.resources/0DFE9D7D-0573-4D06-8CB3-268657D4BF1E.jpg" height="253" width="382"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">TLS 协议主要有五部分：应用数据层协议，握手协议，报警协议，加密消息确认协议，心跳协议。TLS 协议本身又是由 record 协议传输的，record 协议的格式如上图最右所示。
</span></div><div style="text-align: left; float: none;"><img src="http.resources/12D88B97-F7B6-4D40-8F5F-9447F918B09C.jpg" height="1782" width="1569"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; color: rgb(77, 77, 77); line-height: 1.625;">https多原始信息是用密钥key对称加密方式来加密的；其中密钥key是用非对称加密生成的。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; color: rgb(77, 77, 77); line-height: 1.625;"><br/></span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; color: rgb(77, 77, 77); line-height: 1.625;">5、URI\URL\URN</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">URI：统一资源标志符，用来标识互联网上唯一的信息资源，包含URL与URN</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">URL：统一资源定位器，包含ftp协议等</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">URN：永久统一资源定位符，资源移动之后还能被找到，目前不成熟</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">6、http报文</span></div><div style="text-align: left; float: none;"><img src="http.resources/24905096-EE01-487A-AFE9-C5F6BFE299CE.jpg" height="165" width="620"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">HTTP方法：用来定义对资源的操作</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">HTTP CODE：定义服务器对请求的结果，各区间的code有各自的语义，建议前期定义语义化</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-weight: bold; line-height: 1.625;">二、HTTP各种特性总览</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">1、认识http客户端（curl命令行工具）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">是实现发送http报文的工具</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">2、CORS跨域请求的限制于解决</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">原因：浏览器同域的限制</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">处理：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">服务器head头加*</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">jsop原理script、link、a、img标签上的src或者ref是允许跨域的</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">本地代理</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">3、CORS跨域限制以及预请求验证</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">CORS跨域限制</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">CORS预请求</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">允许：GET\HEAD\POST</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">其他：使用预请求验证后才能进行发送</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">允许的Content-Type</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">允许：text/plain \ multipart/form-data \ application/x-www-form-urlencoded</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">其他：使用预请求验证后才能进行发送</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">其他限制：请求头限制、XMLHttpRequestUpload对象均没有注册任何事件监听器、请求中没有使用ReadableStream对象</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">预请求</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">首先发送一个请求request method:option，通过option请求获得服务端的认可，服务端提供返回告诉浏览器，下一个请求是允许的。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">配置：Access-Control-Max-Age</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">4、</span><span style="white-space: pre-wrap; font-size: 16px; color: rgb(64, 64, 64); line-height: 1.625;">详解Http缓存策略</span></div><div style="text-align: left; float: none;"><img src="http.resources/5A5D4544-B19A-497E-90E8-549E093CB33F.jpg" height="613" width="800"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">代理服务器、浏览器、缓存服务器，默认浏览器设置</span></div><div style="text-align: left; float: none;"><img src="http.resources/990D3F53-DCB0-4E8F-845F-124D935B5EA1.jpg" height="1066" width="1086"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); line-height: 1.625;">http中用来判断是否命中强缓存的字段为</span><span style="white-space: pre-wrap; font-size: 12px; background-color: rgb(242, 242, 242); color: rgb(199, 37, 78); font-family: monospace; line-height: 1.625;">Expires</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); line-height: 1.625;">和</span><span style="white-space: pre-wrap; font-size: 12px; background-color: rgb(242, 242, 242); color: rgb(199, 37, 78); font-family: monospace; line-height: 1.625;">Cache-Control</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); line-height: 1.625;">，Cache-Control优先级高于Expires。此处详细讲解Cache-Control</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(250, 212, 211); color: rgb(77, 77, 77); line-height: 1.625;">缓存头</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(250, 212, 211); line-height: 1.625;">Cache-Control</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(250, 212, 211); color: rgb(77, 77, 77); line-height: 1.625;">的含义和使用</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">可缓存性：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">public：代表http请求所经过的任何路径当中（代理服务、发起请求的客户端），都可以对返回内容的缓存的操作</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">pricate：只允许发起请求的浏览器</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">no-cache：任何均不允许，本地可以存，但是必须服务器验证过后</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">到期：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">max-age=：缓存内容过期时间，过期后浏览器再次发送请求到服务器端请求新的内容</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">s-maxage=：可代替max-age，只有在代理服务器中生效</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">max-stale= ：浏览器（发起端）主动带的头，即便缓存已经过期，只要在max-stale时间内任然可以使用缓存</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">重新验证：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">must-revalidate：在设置max-age过期后，必须去源服务端发送请求，重新获取数据，再验 证是否过期，不可直接使用本地缓存</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">proxy-revalidate：应用在缓存服务器当中，指定缓存服务器</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">其他</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">no-store：本地与代理服务器均不可以，每次必须重新请求</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">no-transform：主要用于代理服务器，不允许随意改动，返回内容</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-weight: bold; line-height: 1.625;">http根据是否要向服务器发送请求将缓存规则分为了两类：</span><span style="white-space: pre-wrap; font-size: 12px; background-color: rgb(242, 242, 242); color: rgb(199, 37, 78); font-family: monospace; font-weight: bold; line-height: 1.625;">强缓存</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-weight: bold; line-height: 1.625;">和</span><span style="white-space: pre-wrap; font-size: 12px; background-color: rgb(242, 242, 242); color: rgb(199, 37, 78); font-family: monospace; font-weight: bold; line-height: 1.625;">对比缓存</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-weight: bold; line-height: 1.625;">（对比缓存也叫做</span><span style="white-space: pre-wrap; font-size: 12px; background-color: rgb(242, 242, 242); color: rgb(199, 37, 78); font-family: monospace; font-weight: bold; line-height: 1.625;">协商缓存</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-weight: bold; line-height: 1.625;">）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 20px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-weight: bold; line-height: 1.625;">强缓存</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); line-height: 1.625;">强缓存直接从缓存数据库中取出资源，无需再发送请求到服务器上。强缓存状态码为200，但查看chrome的network会发现状态码后面多了个注释：</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="text-align: left; float: none;"><img src="http.resources/0D7C0C46-2F94-44B9-95DB-F735B96B5389.jpg" height="506" width="612"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); line-height: 1.625;">事实上，强缓存时，这个注释会有两种情况：</span></div><ul><li style="text-align: left; font-size: 16px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-family: &quot;Microsoft YaHei&quot;, STXihei; font-style: normal; font-weight: normal; line-height: 1.875; text-decoration: none;">from memory cache：缓存资源在内存中，浏览器（或页面标签）关闭后内存中的缓存就会被释放，重新打开页面取不到该缓存</span></div></li><li style="text-align: left; font-size: 16px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-family: &quot;Microsoft YaHei&quot;, STXihei; font-style: normal; font-weight: normal; line-height: 1.875; text-decoration: none;">from disk cache：缓存资源在硬盘中，浏览器（或页面标签）关闭后硬盘中的缓存不会消失，下次进入页面还能从硬盘中获取。</span></div></li></ul><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 20px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-weight: bold; line-height: 1.875;">对比缓存</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); line-height: 1.75;">对比缓存是需要经过服务器确认是否使用缓存的机制，其http状态码为</span><span style="white-space: pre-wrap; font-size: 12px; background-color: rgb(242, 242, 242); color: rgb(199, 37, 78); font-family: monospace; line-height: 1.75;">304</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); line-height: 1.75;">，意为</span><span style="white-space: pre-wrap; font-size: 12px; background-color: rgb(242, 242, 242); color: rgb(199, 37, 78); font-family: monospace; line-height: 1.75;">not modified</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); line-height: 1.75;">。其过程如下</span></div><div style="text-align: left; float: none;"><img src="http.resources/95C27724-6349-4B01-9470-B143B6C76FDB.jpg" height="1010" width="1256"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); line-height: 1.625;">是否使用缓存的标志：</span></div><ul><li style="text-align: left; font-size: 16px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-family: &quot;Microsoft YaHei&quot;, STXihei; font-style: normal; font-weight: normal; line-height: 1.875; text-decoration: none;">Last-Modified / If-Modified-Since</span></div></li><li style="text-align: left; font-size: 16px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-family: &quot;Microsoft YaHei&quot;, STXihei; font-style: normal; font-weight: normal; line-height: 1.875; text-decoration: none;">Etag / If-None-Match</span></div></li></ul><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">Etag/If-None-Match策略，</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(64, 64, 64); font-weight: bold; line-height: 1.625;">Etag的优先级是高于 Last-Modified 的</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">Etag：数据签名，资源数据修改则签名会修改。web服务器响应请求时，告诉浏览器当前资源在服务器的唯一标识（生成规则由服务器决定）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">If-None-Match：当资源过期时（使用Cache-Control标识的max-age），发现资源具有Etage声明，则再次向web服务器请求时带上头If-None-Match （Etag的值）。web服务器收到请求后发现有头If-None-Match 则与被请求资源的相应校验串进行对对，决定返回200或304</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">Last-Modified/If-Modified-Since策略</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">Last-Modified：标示这个响应资源的</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(250, 212, 211); color: rgb(77, 77, 77); line-height: 1.625;">最后修改时间</span><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">。web服务器在响应请求时，告诉浏览器资源的最后修改时间。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">If-Modified-Since：当资源过期时（使用Cache-Control标识的max-age），发现资源具有Last-Modified声明，则再次向web服务器请求时带上头 If-Modified-Since，表示请求间。web服务器收到请求后发现有头If-Modified-Since 则与被请求资源的最后修改时间进行对对。若最后修改时间较新，说明资源又被改动过，则响应整片资源内容（写在响应消息包体内），HTTP200；若最后修改时间较旧，说明资源无新修改，则响应HTTP 304 (无需包体，节省浏览)，告知浏览器继续使用所保存的cache</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">5、cookie和session（hostadmin工具，ip地址映射）</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">cookie：通过Set-Cookie设置，Secure只在https的时候发送，HttpOnly无法通过document.cookie访问，domian设置一级域名下的cookie，二级域名均可访问；cookie不可跨域访问</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">session：由服务器生成并维护，本质是</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">特殊的数据库
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">cookie：客户端，本质是文本，存在客户端，可以由服务端生成，但是服务器不维护</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">http无状态协议，可通过session、cookie实现服务器识别，请求状态或url回显
</span></div><div style="text-align: left; float: none;"><img src="http.resources/8825F114-6C9A-45E5-9BB2-42A0B30F9FD8.jpg" height="333" width="674"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; font-weight: bold; line-height: 1.625;">MemoryCache</span></div><ul><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">MemoryCache，是指存在内存中的缓存。优先级上是浏览器最先尝试去命中的一种缓存。效率上是响应速度最快的一种缓存。但也是“短命”的。它和渲染进程“生死相依”，当进程结束后，也就是 tab 关闭以后，内存里的数据也将不复存在。</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">Base64格式的图片几乎永远可以被塞进 memory cache，另外体积不大的 JS、CSS 文件有较大地被写入内存。</span></div></li></ul><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; font-weight: bold; line-height: 1.75;">Service Worker Cache</span></div><ul><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">Service Worker 是一种独立于主线程之外的 Javascript 线程。它脱离于浏览器窗体，因此无法直接访问 DOM。</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">可以帮我们实现离线缓存、消息推送和网络代理等功能</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">Service Worker 的生命周期包括 install、active、working 三个阶段。一旦 Service Worker 被 install，它将始终存在，只会在 active 与 working 之间切换，除非我们主动终止它。这是它可以用来实现离线存储的重要先决条件。</span></div></li></ul><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; font-weight: bold; line-height: 1.625;">Web Storage</span></div><ul><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">Web Storage 是 HTML5 专门为浏览器存储而提供的数据存储机制。它又分为 Local Storage 与 Session Storage。</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: bold; line-height: 1.75; text-decoration: none;">生命周期</span><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: bold; line-height: 1.75; text-decoration: none;">：Local Storage 是持久化的本地存储，存储在其中的数据是永远不会过期的，使其消失的唯一办法是手动删除；而 Session Storage 是临时性的本地存储，它是会话级别的存储，当会话结束（页面被关闭）时，存储内容也随之被释放。</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">作用域：Local Storage、Session Storage 和 Cookie 都遵循同源策略。但 Session Storage 特别的一点在于，即便是相同域名下的两个页面，</span><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: bold; line-height: 1.75; text-decoration: none;">只要它们不在同一个浏览器窗口中打开</span><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">，那么它们的 Session Storage 内容便无法共享。</span></div></li></ul><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; font-weight: bold; line-height: 1.625;">Push Cache</span></div><ul><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">是指 HTTP2 在 server push 阶段存在的缓存</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">Push Cache 是缓存的最后一道防线。浏览器只有在 Memory Cache、HTTP Cache 和 Service Worker Cache 均未命中的情况下才会去询问 Push Cache。</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">Push Cache 是一种存在于会话阶段的缓存，当 session 终止时，缓存也随之释放。</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(34, 34, 34); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">不同的页面只要共享了同一个 HTTP2 连接，那么它们就可以共享同一个 Push Cache。</span></div></li></ul><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.5;">6、http：</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.5;" /><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.5;">keep-Alive</span><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.5;">长连接</span><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.5;"
/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.625;">http 协议采用“请求-应答”模式</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">当使用普通模式，即非 keep-alive 模式时（短连接），每个请求/应答，客户端和服务器都要新建一个连接，完成之后立即断开连接</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.5;">当使用 keep-alive 模式时，keep-alive功能使客户端到服务器端的连接持续有效，当出现对服务器的后继请求时，keep-alive功能避免了建立或者重新建立连接</span></div><ul><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="background-color: rgb(255, 255, 255); font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">http1.0 默认是关闭的，需要在 http 头加入”Connection: keep-alive”，才能启用Keep-Alive</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: disc; background-color: transparent;"><div><span style="background-color: rgb(255, 255, 255); font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">http 1.1 默认启用 keep-alive，加入”Connection: close “才关闭</span></div></li></ul><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">目前大部分浏览器都是用 http1.1 协议，也就是说默认都会发起 keep-alive 的连接请求了，所以是否能完成一个完整的Keep- Alive连接就看服务器设置情况。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">下图是普通模式和长连接模式的请求对比：</span></div><div style="text-align: left; float: none;"><img src="http.resources/2B99045D-5E84-4ED5-BBF0-8E8E0F798C74.jpg" height="280" width="450"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); font-family: Verdana; font-weight: bold; line-height: 1.5;">keep-alive 的优缺点</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">优点：keep-alive 模式更加高效，因为避免了连接建立和释放的开销</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">缺点：长时间的 tcp 连接容易导致系统资源无效占用，浪费系统资源</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">7、数据协商</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">请求：Accept、Accept-Encoding，Accept-Language，User-Agent</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">返回：Content，Content-Type，Content-Encoding（压缩），Content-Language</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">8、Redirect</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 16px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">code：302（临时路径）、301（永久路径，会有缓存，需要清除本地缓存），资源重定向</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">10、CDN概念
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: Verdana; line-height: 1.75;">CDN的全称是Content Delivery Network，即内容分发网络</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">CDN的优势</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">（1）CDN节点解决了跨运营商和跨地域访问的问题，访问延时大大降低；</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">（2）大部分请求在CDN边缘节点完成，CDN起到了分流作用，减轻了源站的负载。</span></div><div style="text-align: left; float: none;"><img src="http.resources/C9DD3DD3-92B3-4AD8-998A-4CFBA1AB3E4E.jpg" height="605" width="1156"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; font-weight: bold; line-height: 1.75;">CDN缓存</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">浏览器本地缓存失效后，浏览器会向CDN边缘节点发起请求。类似浏览器缓存，CDN边缘节点也存在着一套缓存机制。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; font-weight: bold; line-height: 1.75;">CDN缓存的缺点</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">CDN的分流作用不仅减少了用户的访问延时，也减少的源站的负载。但其缺点也很明显：当网站更新时，如果CDN节点上数据没有及时更新，即便用户再浏览器使用Ctrl+F5的方式使浏览器端的缓存失效，也会因为CDN边缘节点没有同步最新数据而导致用户访问异常。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; font-weight: bold; line-height: 1.75;">CDN的缓存机制</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">　　CDN边缘节点缓存策略因服务商不同而不同，但一般都会遵循http标准协议，通过http响应头中的Cache-control: max-age的字段来设置CDN边缘节点数据缓存时间。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">当客户端向CDN节点请求数据时，CDN节点会判断缓存数据是否过期，若缓存数据并没有过期，则直接将缓存数据返回给客户端；否则，CDN节点就会向源站发出回源请求，从源站拉取最新数据，更新本地缓存，并将最新数据返回给客户端。所以，如果我们修改了内容，最好加个版本号，来容CDN重新获取资源，从而减少不必要的麻烦，比如 :</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">app.js?v=20171114 或者 style.css?v=20171114</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; font-weight: bold; line-height: 1.75;">CDN缓存刷新</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); font-family: Verdana; line-height: 1.75;">CDN边缘节点对开发者是透明的，相比于浏览器Ctrl+F5的强制刷新来使浏览器本地缓存失效，开发者可以通过CDN服务商提供的“刷新缓存”接口来达到清理CDN边缘节点缓存的目的。这样开发者在更新数据后，可以使用“刷新缓存”功能来强制CDN节点上的数据缓存过期，保证客户端在访问时，拉取到最新的数据。</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">11、DNS详解
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">DNS 是Domain Name System, 域名系统，用于将域名转换为IP。
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">顶级域名
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">域名资源记录
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">域名服务器
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">域名解析
</span></div><div style="text-align: left; float: none;"><img src="http.resources/F8343B91-FA9C-4A1C-8054-F7537686A44B.jpg" height="535" width="962"/><br/></div><div style="text-align: left; float: none;"><img src="http.resources/6B7C9600-B682-4F77-A7A6-170518E65344.jpg" height="447" width="1000"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; font-weight: bold; line-height: 1.625;">三、浏览器缓存机制</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(238, 240, 244); color: rgb(34, 34, 34); font-family: -apple-system; line-height: 1.625;">浏览器缓存机制四个方面，优先级依次排列如下：</span></div><ol><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">Memory Cache</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">Service Worker Cache</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">HTTP Cache</span></div></li><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="font-size: 14px; color: rgb(0, 0, 0); font-family: -apple-system; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">Push Cache</span></div></li></ol><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">缓存会根据请求保存输出内容的副本，例如html页面，图片，文件，当下一个请求来到的时候：如果是相同的URL，缓存直接使用副本响应访问请求，而不是向源服务器再次发送请求。
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">缓存的优点：减少相应延迟、减少网络带宽消耗
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">浏览器渲染过程：
</span></div><div style="text-align: left; float: none;"><img src="http.resources/EA76E2F1-2EFD-451F-814B-2A7B00C28184.jpg" height="587" width="983"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(238, 238, 238); font-family: Verdana; font-weight: bold; line-height: 1.625;">浏览器缓存刷新</span></div><ol><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="background-color: rgb(238, 236, 224); font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">在地址栏中输入网址后按回车或点击转到按钮</span></div></li></ol><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(238, 236, 224); font-family: Verdana; line-height: 1.75;">浏览器以最少的请求来获取网页的数据，浏览器会对所有没有过期的内容直接使用本地缓存，从而减少了对浏览器的请求。所以，Expires，max-age标记只对这种方式有效。</span></div><ol start="2"><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="background-color: rgb(238, 236, 224); font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">按F5或浏览器刷新按钮</span></div></li></ol><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(238, 236, 224); font-family: Verdana; line-height: 1.75;">浏览器会在请求中附加必要的缓存协商，但不允许浏览器直接使用本地缓存，它能够让 Last-Modified、ETag发挥效果，但是对Expires无效。</span></div><ol start="3"><li style="text-align: left; font-size: 14px; list-style-position: inside; white-space: pre-wrap; word-break: break-word; list-style-type: decimal; background-color: transparent;"><div><span style="background-color: rgb(238, 236, 224); font-size: 14px; color: rgb(0, 0, 0); font-family: Verdana; font-style: normal; font-weight: normal; line-height: 1.75; text-decoration: none;">按Ctrl+F5或按Ctrl并点击刷新按钮</span></div></li></ol><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(238, 236, 224); font-family: Verdana; line-height: 1.75;">这种方式就是强制刷新，总会发起一个全新的请求，不使用任何缓存。</span></div><div style="text-align: left; float: none;"><img src="http.resources/B9E84765-AB39-4EB6-8BC3-CDBB305FA875.jpg" height="610" width="1124"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="text-align: left; float: none;"><img src="http.resources/0B9CDD4C-5FAC-4098-A9F5-CDBAF016D071.jpg" height="662" width="1112"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 18px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); font-weight: bold; line-height: 1.625;">四、Nginx代理以及面向未来的HTTP</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">nginx事件驱动
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.625;">加密和SSL加速
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">负载均衡
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">缓存静态内容
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">压缩
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">减速上传
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">安全
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; line-height: 1.75;">外网发布
</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">Nginx安装和基础代理配置</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">安装包，dos命令下执行nginx.exe</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">Ngix代理配置和代理缓存的用处</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;"># proxy_pass </span><a style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;" href="http://127.0.0.1/">http://127.0.0.1</a><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">;</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;"># proxy_set_header Host $host; // 区分实际访问的服务，一台机器跑不同的服务</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">HTTPS解析</span></div><div style="text-align: left; float: none;"><img src="http.resources/58174F62-D78D-4B28-B3D9-3E988EC184C0.jpg" height="393" width="724"/><br/></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">使用Nginx部署HTTP服务</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">HTTP2的优势和Nginx配置HTTP2的简单使用</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">信复用</span></div><div style="white-space: pre-wrap; text-align: left; font-size: 14px;"><span style="white-space: pre-wrap; font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(77, 77, 77); line-height: 1.625;">分帧传输</span></div></body></html>